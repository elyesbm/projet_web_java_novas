{% extends 'admin/base_admin.html.twig' %}

{% block title %}{{ mode|default('create') == 'create' ? 'Nouvelle' : 'Modifier' }} catégorie - NOVAS Admin{% endblock %}
{% block page_title %}{{ mode|default('create') == 'create' ? 'Nouvelle catégorie' : 'Modifier la catégorie' }}{% endblock %}
{% block page_subtitle %}{{ mode|default('create') == 'create' ? 'Ajouter une catégorie au marketplace' : 'Modifier la catégorie existante' }}{% endblock %}

{% block body %}
<div class="max-w-3xl mx-auto">
    <form id="admin-marketplace-categorie-form" method="post" class="space-y-6">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6 space-y-4">
            <div class="space-y-2">
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Nom de la catégorie <span class="text-rose-500">*</span>
                </label>
                <input
                    type="text"
                    name="nom"
                    value="{{ categorie is defined and categorie ? categorie.nomCategorie : '' }}"
                    class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-rose-500"
                    placeholder="ex : Livres, Electronique..."
                >
            </div>
            <div class="space-y-2">
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">
                    Description
                </label>
                <textarea
                    name="description"
                    rows="4"
                    class="w-full px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-rose-500 resize-none"
                    placeholder="Description courte de la catégorie (optionnel)..."
                >{{ categorie is defined and categorie ? categorie.descriptionCategorie : '' }}</textarea>
            </div>
        </div>

        <div class="flex gap-3">
            <button type="submit" class="px-5 py-2.5 rounded-xl bg-gradient-to-r from-rose-500 to-pink-600 hover:from-rose-600 hover:to-pink-700 text-white font-medium shadow-lg shadow-rose-500/25 transition-all">
                {{ mode|default('create') == 'create' ? 'Créer la catégorie' : 'Enregistrer' }}
            </button>
            <a href="{{ path('app_admin_marketplace_list') }}" class="px-5 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300 font-medium transition-colors">
                Annuler
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        (function () {
            const form = document.getElementById('admin-marketplace-categorie-form');
            if (!form) return;

            function showNotification(message, type = 'error') {
                const containerId = 'admin-marketplace-categorie-notification-container';
                let container = document.getElementById(containerId);
                if (!container) {
                    container = document.createElement('div');
                    container.id = containerId;
                    container.className = 'fixed top-24 right-4 z-50 space-y-2';
                    document.body.appendChild(container);
                }

                const bgClass = type === 'success' ? 'bg-emerald-600' : 'bg-red-600';
                const notif = document.createElement('div');
                notif.className = `${bgClass} text-white px-4 py-3 rounded-xl shadow-lg flex items-start gap-3 border border-white/20`;
                notif.innerHTML = `
                    <div class="mt-0.5">
                        <i data-lucide="${type === 'success' ? 'check-circle' : 'alert-circle'}" class="w-5 h-5"></i>
                    </div>
                    <div class="text-sm">${message}</div>
                `;
                container.appendChild(notif);
                if (window.lucide && typeof window.lucide.createIcons === 'function') {
                    window.lucide.createIcons();
                }

                setTimeout(() => {
                    notif.classList.add('opacity-0');
                    setTimeout(() => notif.remove(), 180);
                }, 3500);
            }

            form.addEventListener('submit', function (e) {
                const data = new FormData(form);
                const errors = [];

                const nom = (data.get('nom') || '').toString().trim();
                const description = (data.get('description') || '').toString().trim();

                if (!nom) {
                    errors.push('Le nom de la categorie est obligatoire.');
                } else if (nom.length < 2) {
                    errors.push('Le nom doit contenir au moins 2 caracteres.');
                } else if (nom.length > 255) {
                    errors.push('Le nom ne doit pas depasser 255 caracteres.');
                }

                if (description.length > 1000) {
                    errors.push('La description est trop longue (max 1000 caracteres).');
                }

                if (errors.length > 0) {
                    e.preventDefault();
                    errors.forEach((msg) => showNotification(msg, 'error'));
                }
            });
        })();
    </script>
{% endblock %}
