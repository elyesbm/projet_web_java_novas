{% extends 'admin/base_admin.html.twig' %}

{% block title %}{{ mode == 'create' ? 'Nouvel' : 'Modifier' }} utilisateur - NOVAS Admin{% endblock %}
{% block page_title %}{{ mode == 'create' ? 'Nouvel utilisateur' : 'Modifier utilisateur' }}{% endblock %}
{% block page_subtitle %}{{ mode == 'create' ? 'Créer un nouveau compte' : 'Modifier les informations' }}{% endblock %}

{% block body %}
<div class="max-w-3xl mx-auto">
    {% for message in app.flashes('success') %}
        <div class="rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 text-emerald-800 dark:text-emerald-200 px-4 py-3 mb-4">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="rounded-xl bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 text-rose-800 dark:text-rose-200 px-4 py-3 mb-4">{{ message }}</div>
    {% endfor %}

    {{ form_start(form, { 'attr': { 'class': 'space-y-6', 'novalidate': 'novalidate' } }) }}

        {# Erreurs globales du formulaire #}
        {{ form_errors(form) }}

        {# Avatar preview #}
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
            <div class="flex items-center gap-6">
                {% if user.IMAGE %}
                    <img src="{{ user.IMAGE }}" alt="" class="w-24 h-24 rounded-2xl object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-primary-500 to-secondary-500 flex items-center justify-center text-white text-3xl font-bold" style="display:none;">{{ user.PRENOM|default('')|slice(0,1) }}{{ user.NOM|default('')|slice(0,1) }}</div>
                {% else %}
                    <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-primary-500 to-secondary-500 flex items-center justify-center text-white text-3xl font-bold">{{ user.PRENOM|default('')|slice(0,1) }}{{ user.NOM|default('')|slice(0,1) }}</div>
                {% endif %}
                <div>
                    <h4 class="font-semibold text-slate-900 dark:text-white mb-1">Photo de profil</h4>
                    <p class="text-sm text-slate-500">Saisir l'URL de l'image dans le champ ci-dessous.</p>
                </div>
            </div>
        </div>

        {# Informations #}
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Informations personnelles</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="space-y-2">
                    {{ form_label(form.NOM) }}
                    {{ form_widget(form.NOM, {'errors': false}) }}
                    <div class="text-rose-500 text-xs">{{ form_errors(form.NOM) }}</div>
                </div>
                <div class="space-y-2">
                    {{ form_label(form.PRENOM) }}
                    {{ form_widget(form.PRENOM, {'errors': false}) }}
                    <div class="text-rose-500 text-xs">{{ form_errors(form.PRENOM) }}</div>
                </div>
            </div>
            <div class="space-y-2 mb-6">
                {{ form_label(form.EMAIL) }}
                {{ form_widget(form.EMAIL, {'errors': false}) }}
                <div class="text-rose-500 text-xs">{{ form_errors(form.EMAIL) }}</div>
            </div>
            <div class="space-y-2 mb-6">
                {{ form_label(form.NUMERO) }}
                <div class="relative">
                    <i data-lucide="phone" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 z-10"></i>
                    {{ form_widget(form.NUMERO, {'errors': false}) }}
                </div>
                <div class="text-rose-500 text-xs">{{ form_errors(form.NUMERO) }}</div>
            </div>
            <div class="space-y-2">
                {{ form_label(form.IMAGE) }}
                {{ form_widget(form.IMAGE, {'errors': false}) }}
                <div class="text-rose-500 text-xs">{{ form_errors(form.IMAGE) }}</div>
            </div>
        </div>

        {# Rôle #}
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Rôle</h3>
            <div class="space-y-2">
                {{ form_label(form.ROLE) }}
                {{ form_widget(form.ROLE, {'errors': false}) }}
                <div class="text-rose-500 text-xs">{{ form_errors(form.ROLE) }}</div>
            </div>
        </div>

        {# Mot de passe #}
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Mot de passe</h3>
            <div class="space-y-2">
                {{ form_label(form.plainPassword) }}
                {{ form_widget(form.plainPassword, {'errors': false}) }}
                <div class="text-rose-500 text-xs">{{ form_errors(form.plainPassword) }}</div>
            </div>
            {% if mode == 'edit' %}
                <p class="text-sm text-slate-500 mt-2">Laisser vide pour conserver le mot de passe actuel.</p>
            {% endif %}
        </div>

        {# Actions #}
        <div class="flex items-center justify-between pt-6">
            <a href="{{ path('app_admin_users_list') }}" class="flex items-center gap-2 px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300 font-medium">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                Annuler
            </a>
            <button type="submit" class="flex items-center gap-2 px-8 py-3 rounded-xl bg-gradient-to-r from-primary-600 to-secondary-600 hover:from-primary-700 hover:to-secondary-700 text-white font-medium shadow-lg shadow-primary-500/25 transition-all">
                <i data-lucide="check" class="w-4 h-4"></i>
                {{ mode == 'create' ? 'Créer l\'utilisateur' : 'Enregistrer' }}
            </button>
        </div>
    {{ form_end(form) }}
</div>
{% endblock %}
