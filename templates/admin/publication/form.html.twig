{% extends 'admin/base_admin.html.twig' %}

{% block title %}Modérer publication - NOVAS Admin{% endblock %}
{% block page_title %}Modération de publication{% endblock %}
{% block page_subtitle %}Examiner et modérer le contenu signalé{% endblock %}

{% block body %}
<div class="max-w-4xl mx-auto">
    {# Alert Banner (tu pourras le rendre dynamique plus tard) #}
    <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-2xl p-6 mb-6 flex items-start gap-4">
        <div class="w-12 h-12 rounded-xl bg-amber-100 dark:bg-amber-900/30 text-amber-600 flex items-center justify-center shrink-0">
            <i data-lucide="alert-triangle" class="w-6 h-6"></i>
        </div>
        <div>
            <h3 class="font-semibold text-amber-900 dark:text-amber-400 mb-1">Publication signalée</h3>
            <p class="text-amber-700 dark:text-amber-300 text-sm">
                Cette publication a été signalée. (à rendre dynamique plus tard)
            </p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 space-y-6">
            {# Publication Content #}
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
                <div class="flex items-center gap-3 mb-6">
                    {% if publication.auteur and publication.auteur.IMAGE %}
                        <img src="{{ asset('images/' ~ publication.auteur.IMAGE) }}" class="w-12 h-12 rounded-full object-cover">
                    {% else %}
                        <img src="https://ui-avatars.com/api/?name={{ (publication.auteur ? (publication.auteur.PRENOM ~ ' ' ~ publication.auteur.NOM) : 'Utilisateur')|url_encode }}&background=random"
                             class="w-12 h-12 rounded-full">
                    {% endif %}

                    <div>
                        <p class="font-semibold text-slate-900 dark:text-white">
                            {{ publication.auteur ? (publication.auteur.PRENOM ~ ' ' ~ publication.auteur.NOM) : 'Utilisateur' }}
                        </p>
                        <p class="text-sm text-slate-500">
                            {{ publication.dateCreation ? publication.dateCreation|date('d/m/Y H:i') : '' }}
                        </p>
                    </div>

                    {# Badge contexte #}
                    {% set contextMap = { 1: 'academic', 2: 'personal', 3: 'help' } %}
                    {% set contexte = contextMap[publication.contexte] ?? 'help' %}

                    <span class="ml-auto px-3 py-1 rounded-full text-xs font-medium
                        {{ contexte == 'academic' ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' :
                           contexte == 'personal' ? 'bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-400' :
                           'bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-400' }}">
                        {{ contexte == 'academic' ? 'Académique' : contexte == 'personal' ? 'Personnel' : 'Entraide' }}
                    </span>
                </div>

                <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">
                    {{ publication.titre }}
                </h3>

                <p class="text-slate-600 dark:text-slate-400 leading-relaxed mb-6">
                    {{ publication.contenu }}
                </p>

                <div class="flex items-center gap-6 text-sm text-slate-500 border-t border-slate-200 dark:border-slate-700 pt-4">
                    <span class="flex items-center gap-2">
                        <i data-lucide="heart" class="w-4 h-4"></i>{{ publication.likes ?? 0 }} likes
                    </span>
                    <span class="flex items-center gap-2">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>{{ publication.commentaires|length }} commentaires
                    </span>
                </div>
            </div>

            {# Comments #}
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">
                    Commentaires ({{ publication.commentaires|length }})
                </h3>

                <div class="space-y-4">
                    {% for c in publication.commentaires %}
                        <div class="flex gap-3 p-4 rounded-xl bg-slate-50 dark:bg-slate-700/30">
                            {% if c.auteur and c.auteur.IMAGE %}
                                <img src="{{ asset('images/' ~ c.auteur.IMAGE) }}" class="w-10 h-10 rounded-full object-cover">
                            {% else %}
                                <img src="https://ui-avatars.com/api/?name={{ (c.auteur ? (c.auteur.PRENOM ~ ' ' ~ c.auteur.NOM) : 'Utilisateur')|url_encode }}&background=random"
                                     class="w-10 h-10 rounded-full">
                            {% endif %}

                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-semibold text-slate-900 dark:text-white">
                                        {{ c.auteur ? (c.auteur.PRENOM ~ ' ' ~ c.auteur.NOM) : 'Utilisateur' }}
                                    </span>
                                    <span class="text-xs text-slate-500">
                                        {{ c.dateCreation ? c.dateCreation|date('d/m/Y H:i') : '' }}
                                    </span>
                                </div>
                                <p class="text-slate-600 dark:text-slate-400 text-sm">
                                    {{ c.contenu }}
                                </p>
                            </div>
                        </div>
                    {% else %}
                        <p class="text-slate-500 text-sm">Aucun commentaire.</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        {# Sidebar Actions (UI uniquement pour l’instant) #}
        <div class="space-y-6">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Décision</h3>
                <div class="space-y-3">

    {# Approuver #}
    <form method="post" action="{{ path('app_admin_publications_approve', {id: publication.id}) }}">
        <input type="hidden" name="_token" value="{{ csrf_token('admin_pub_action_' ~ publication.id) }}">
        <button type="submit"
                class="w-full p-4 rounded-xl border-2 border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-100 dark:hover:bg-emerald-900/30 transition-colors text-left">
            <div class="flex items-center gap-3">
                <i data-lucide="check-circle" class="w-6 h-6"></i>
                <div>
                    <p class="font-semibold">Approuver</p>
                    <p class="text-xs opacity-80">Conforme aux règles</p>
                </div>
            </div>
        </button>
    </form>

    {# Masquer #}
    <form method="post" action="{{ path('app_admin_publications_hide', {id: publication.id}) }}">
        <input type="hidden" name="_token" value="{{ csrf_token('admin_pub_action_' ~ publication.id) }}">
        <button type="submit"
                class="w-full p-4 rounded-xl border-2 border-amber-500 bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition-colors text-left">
            <div class="flex items-center gap-3">
                <i data-lucide="eye-off" class="w-6 h-6"></i>
                <div>
                    <p class="font-semibold">Masquer</p>
                    <p class="text-xs opacity-80">Retirer temporairement</p>
                </div>
            </div>
        </button>
    </form>

    {# Supprimer #}
    <form method="post" action="{{ path('app_admin_publications_delete', {id: publication.id}) }}">
        <input type="hidden" name="_token" value="{{ csrf_token('admin_delete_pub_' ~ publication.id) }}">
        <button type="submit"
                class="w-full p-4 rounded-xl border-2 border-rose-500 bg-rose-50 dark:bg-rose-900/20 text-rose-700 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/30 transition-colors text-left">
            <div class="flex items-center gap-3">
                <i data-lucide="trash-2" class="w-6 h-6"></i>
                <div>
                    <p class="font-semibold">Supprimer</p>
                    <p class="text-xs opacity-80">Effacer définitivement</p>
                </div>
            </div>
        </button>
    </form>

</div>

            </div>

            {# Les deux blocs suivants restent statiques pour l’instant (signalements/historique) #}
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Signalements</h3>
                <p class="text-slate-500 text-sm">À implémenter (table signalements).</p>
            </div>

            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Historique auteur</h3>
                <p class="text-slate-500 text-sm">À implémenter (stats auteur).</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
