{% extends 'admin/base_admin.html.twig' %}

{% block title %}{{ mode == 'create' ? 'Nouvel atelier' : 'Modifier atelier' }}{% endblock %}
{% block page_title %}{{ mode == 'create' ? 'Nouvel atelier' : 'Modifier l’atelier' }}{% endblock %}
{% block page_subtitle %}Programmer un événement de formation{% endblock %}

{% block body %}

{{ form_start(form, {
    attr: {
        class: 'max-w-5xl mx-auto',
        novalidate: 'novalidate'
    }
}) }}

{# MESSAGE GLOBAL #}
{% if not form.vars.valid %}
<div class="mb-6 p-4 rounded-xl bg-red-50 border border-red-300 text-red-700">
    Veuillez corriger les champs en rouge.
</div>
{% endif %}

<!-- HEADER -->
<div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white mb-6 shadow-lg">
    <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center">
            <i data-lucide="calendar-days" class="w-8 h-8"></i>
        </div>
        <div>
            <h2 class="text-2xl font-bold">Détails de l'atelier</h2>
            <p class="text-indigo-100">Créez une expérience d'apprentissage</p>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- COL GAUCHE -->
    <div class="lg:col-span-2 space-y-6">
        <div class="bg-white rounded-2xl p-6 shadow">

            {# TITRE #}
            {% set e = form.titre_atelier.vars.errors|length %}
            <label class="block mb-2 font-medium">Titre</label>
            {{ form_widget(form.titre_atelier, {
                attr: {
                    class: 'w-full px-4 py-3 rounded-xl border text-lg ' ~
                           (e ? 'border-red-500 bg-red-50' : 'border-gray-300')
                }
            }) }}
            {{ form_errors(form.titre_atelier) }}

            {# CONTEXTE #}
            <label class="block mt-6 mb-2 font-medium">Contexte</label>
            <div class="grid grid-cols-2 gap-4">
                {% for child in form.contexte_atelier %}
                    <label class="cursor-pointer">
                        {{ form_widget(child, { attr: { class: 'peer sr-only' } }) }}
                        <div class="p-4 rounded-xl border-2 text-center
                            peer-checked:border-indigo-500 peer-checked:bg-indigo-50 transition">
                            {% if child.vars.value == 1 %}
                                <i data-lucide="cpu" class="w-6 h-6 mx-auto mb-2 text-indigo-500"></i>
                                <strong>Hard Skill</strong>
                            {% else %}
                                <i data-lucide="heart-handshake" class="w-6 h-6 mx-auto mb-2 text-purple-500"></i>
                                <strong>Soft Skill</strong>
                            {% endif %}
                        </div>
                    </label>
                {% endfor %}
            </div>
            {{ form_errors(form.contexte_atelier) }}

            {# TYPE #}
            {% set e = form.type_atelier.vars.errors|length %}
            <label class="block mt-6 mb-2 font-medium">Type</label>
            {{ form_widget(form.type_atelier, {
                attr: {
                    class: 'w-full px-4 py-3 rounded-xl border ' ~
                           (e ? 'border-red-500 bg-red-50' : 'border-gray-300')
                }
            }) }}
            {{ form_errors(form.type_atelier) }}

            {# DESCRIPTION #}
            {% set e = form.description_atelier.vars.errors|length %}
            <label class="block mt-6 mb-2 font-medium">Description</label>
            {{ form_widget(form.description_atelier, {
                attr: {
                    class: 'w-full px-4 py-3 rounded-xl border resize-none ' ~
                           (e ? 'border-red-500 bg-red-50' : 'border-gray-300'),
                    rows: 4
                }
            }) }}
            {{ form_errors(form.description_atelier) }}

            {# DATE #}
            {% set e = form.date_atelier.vars.errors|length %}
            <label class="block mt-6 mb-2 font-medium">Date</label>
            {{ form_widget(form.date_atelier, {
                attr: {
                    class: 'w-full px-4 py-3 rounded-xl border ' ~
                           (e ? 'border-red-500 bg-red-50' : 'border-gray-300')
                }
            }) }}
            {{ form_errors(form.date_atelier) }}

        </div>
    </div>

    <!-- COL DROITE -->
    <div class="space-y-6">

        {# CAPACITÉ #}
        {% set e = form.capacite.vars.errors|length %}
        <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="font-semibold mb-2">Capacité</h3>
            {{ form_widget(form.capacite, {
                attr: {
                    class: 'w-full px-4 py-3 rounded-xl border text-center text-xl font-bold ' ~
                           (e ? 'border-red-500 bg-red-50' : 'border-gray-300')
                }
            }) }}
            {{ form_errors(form.capacite) }}
        </div>

        {# IMAGE URL #}
        {% set e = form.image_atelier.vars.errors|length %}
        <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="font-semibold mb-2">Image (URL)</h3>
            {{ form_widget(form.image_atelier, {
                attr: {
                    class: 'w-full px-4 py-3 rounded-xl border ' ~
                           (e ? 'border-red-500 bg-red-50' : 'border-gray-300'),
                    oninput: 'previewImage(this.value)'
                }
            }) }}
            {{ form_errors(form.image_atelier) }}
            <img id="preview" class="mt-4 rounded-xl hidden max-h-48 mx-auto">
        </div>

        {# STATUT #}
        <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="font-semibold mb-2">Statut</h3>
            {{ form_widget(form.statut_atelier) }}
            {{ form_errors(form.statut_atelier) }}
        </div>

        {# ACTIONS #}
        <div class="flex flex-col gap-3">
            <button type="submit"
                class="w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium">
                {{ mode == 'create' ? 'Créer l’atelier' : 'Enregistrer' }}
            </button>

            <a href="{{ path('app_admin_ateliers_list') }}"
               class="w-full py-3 rounded-xl border text-center">
                Annuler
            </a>
        </div>

    </div>
</div>

{{ form_end(form) }}

<script>
function previewImage(url) {
    const img = document.getElementById('preview');
    if (!url) {
        img.classList.add('hidden');
        return;
    }
    img.src = url;
    img.classList.remove('hidden');
}
</script>

{% endblock %}

