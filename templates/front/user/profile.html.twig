{% extends 'front/base_home.html.twig' %}

{% block title %}Mon Profil - NoVas{% endblock %}

{% block body %}
{% include 'front/partials/_auth_nav.html.twig' %}

<section class="relative min-h-screen pt-32 pb-16">
    <div class="absolute inset-0 -z-10">
        <div class="absolute top-20 left-10 w-72 h-72 bg-primary/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-academic/10 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-3xl mx-auto px-6">
        <div class="glass-card rounded-3xl p-8 md:p-12">
            <h2 class="font-serif text-2xl font-semibold text-foreground mb-8 flex items-center gap-2">
                <i data-lucide="user" class="w-6 h-6 text-primary"></i>
                Mon profil
            </h2>

            <div class="flex flex-col sm:flex-row items-center sm:items-start gap-8">
                <div class="flex-shrink-0">
                    {% set avatarFallback = 'https://ui-avatars.com/api/?name=' ~ user.PRENOM|url_encode ~ '+' ~ user.NOM|url_encode ~ '&size=128' %}
                    {% set userImage = user.IMAGE ? user.IMAGE|trim : '' %}
                    {% set userImageSrc = userImage
                        ? ((userImage starts with 'http://' or userImage starts with 'https://' or userImage starts with '/')
                            ? userImage
                            : asset('images/' ~ userImage))
                        : avatarFallback %}
                    <img src="{{ userImageSrc }}" alt="" class="w-32 h-32 rounded-2xl object-cover ring-4 ring-primary/20 shadow-xl" onerror="this.src='{{ avatarFallback }}'">
                </div>
                <div class="flex-1 w-full space-y-6">
                    <div>
                        <p class="text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1">Nom complet</p>
                        <p class="text-xl font-semibold text-foreground">{{ user.PRENOM }} {{ user.NOM }}</p>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1">Email</p>
                        <p class="text-foreground flex items-center gap-2">
                            <i data-lucide="mail" class="w-4 h-4 text-primary"></i>
                            {{ user.EMAIL }}
                        </p>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1">Téléphone</p>
                        <p class="text-foreground flex items-center gap-2">
                            <i data-lucide="phone" class="w-4 h-4 text-primary"></i>
                            {{ user.NUMERO is not null and user.NUMERO != '' ? user.NUMERO : '—' }}
                        </p>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-muted-foreground uppercase tracking-wider mb-1">Rôle</p>
                        <p class="flex items-center gap-2">
                            {% if user.ROLE == 'ROLE_ADMIN' %}
                                <span class="px-3 py-1.5 rounded-full text-sm font-medium bg-purple-500/20 text-purple-400 border border-purple-500/30">Admin</span>
                            {% elseif user.ROLE == 'ROLE_PSY' %}
                                <span class="px-3 py-1.5 rounded-full text-sm font-medium bg-teal-500/20 text-teal-400 border border-teal-500/30">Psy</span>
                            {% else %}
                                <span class="px-3 py-1.5 rounded-full text-sm font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30">Étudiant</span>
                            {% endif %}
                        </p>
                    </div>
                    
                </div>
            </div>
            <!-- 2FA Management -->
            {% include 'front/user/_2fa_management.html.twig' %}
            <div class="mt-10 pt-8 border-t border-border/50">
                <h3 class="text-sm font-semibold text-foreground mb-4">Résumé de l’activité</h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div class="glass-card rounded-xl p-4 text-center">
                        <p class="text-2xl font-bold text-primary">{{ user.publications|length }}</p>
                        <p class="text-xs text-muted-foreground">Publications</p>
                    </div>
                    <div class="glass-card rounded-xl p-4 text-center">
                        <p class="text-2xl font-bold text-accent">{{ user.commentaires|length }}</p>
                        <p class="text-xs text-muted-foreground">Commentaires</p>
                    </div>
                    <div class="glass-card rounded-xl p-4 text-center">
                        <p class="text-2xl font-bold text-academic">{{ user.reservations|length }}</p>
                        <p class="text-xs text-muted-foreground">Réservations</p>
                    </div>
                    <div class="glass-card rounded-xl p-4 text-center">
                        <p class="text-2xl font-bold text-personal">{{ user.offrejobs|length }}</p>
                        <p class="text-xs text-muted-foreground">Offres créées</p>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex flex-wrap gap-4">
                <a href="{{ path('app_home') }}" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl border border-border hover:bg-white/5 transition-colors text-sm font-medium">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    Retour à l’accueil
                </a>
                <a href="{{ path('app_user_edit') }}" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl bg-primary text-white hover:bg-primary/90 transition-colors text-sm font-medium shadow-lg shadow-primary/25">
                    <i data-lucide="edit" class="w-4 h-4"></i>
                    Modifier mon profil
                </a>
            </div>
        </div>
    </div>
</section>

<script>
    if (typeof lucide !== 'undefined') lucide.createIcons();
</script>
{% endblock %}
