# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    openai_api_key: '%env(OPENAI_API_KEY)%'
    gemini_api_key: '%env(GEMINI_API_KEY)%'
    ai_provider: 'huggingface'
    ai_hf_model: 'katanemo/Arch-Router-1.5B'
    ai_gemini_model: 'gemini-1.5-flash-latest'
    translate_provider: 'mymemory'
    tts_provider: 'voicerss'
    voicerss_verify_ssl: '1'
    voicerss_cafile: ''
    app.toxicity.hf_token: '%env(default::HF_TOKEN)%'
    app.toxicity.inference_url: '%env(default::HF_INFERENCE_URL)%'
    app.toxicity.script_path: '%env(default::HF_TOXICITY_SCRIPT)%'
    app.toxicity.project_dir: '%kernel.project_dir%'
    app.sentiment.hf_token: '%env(default::HF_TOKEN)%'
    app.sentiment.inference_url: '%env(default::HF_SENTIMENT_URL)%'
    app.sentiment.script_path: '%env(default::HF_SENTIMENT_SCRIPT)%'
    app.sentiment.project_dir: '%kernel.project_dir%'
    app.translation.api_url: '%env(string:TRANSLATION_API_URL)%'
    app.translation.api_key: '%env(string:TRANSLATION_API_KEY)%'
    app.hf_image.token: '%env(default::HF_TOKEN)%'
    app.hf_image.model: '%env(default::HF_IMAGE_MODEL)%'
    app.hf_image.base_url: '%env(default::HF_IMAGE_BASE_URL)%'
    app.hf_image.script_path: '%env(default::HF_IMAGE_SCRIPT)%'
    app.hf_image.provider: '%env(default::HF_IMAGE_PROVIDER)%'
    app.hf_image.project_dir: '%kernel.project_dir%'

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'
            - '../src/Polyfill/'

    App\EventListener\LoginSuccessListener:
        tags:
            # Priorité haute pour que notre redirection par rôle s'applique (événement = FQCN en Symfony 6)
            - { name: kernel.event_listener, event: Symfony\Component\Security\Http\Event\LoginSuccessEvent, method: onLoginSuccess, priority: 100 }

    App\EventListener\TwoFactorAuthenticationListener:
        tags:
            - { name: kernel.event_subscriber, priority: 200 }

    App\EventListener\RequireTwoFactorListener:
        tags:
            - { name: kernel.event_subscriber }

    App\Service\ToxicityAnalysisService:
        arguments:
            $hfToken: '%app.toxicity.hf_token%'
            $inferenceUrl: '%app.toxicity.inference_url%'
            $scriptPath: '%app.toxicity.script_path%'
            $projectDir: '%app.toxicity.project_dir%'

    App\Service\SentimentAnalysisService:
        arguments:
            $hfToken: '%app.sentiment.hf_token%'
            $inferenceUrl: '%app.sentiment.inference_url%'
            $scriptPath: '%app.sentiment.script_path%'
            $projectDir: '%app.sentiment.project_dir%'

    App\Service\HuggingFaceImageService:
        arguments:
            $hfToken: '%app.hf_image.token%'
            $model: '%app.hf_image.model%'
            $baseUrl: '%app.hf_image.base_url%'
            $scriptPath: '%app.hf_image.script_path%'
            $projectDir: '%app.hf_image.project_dir%'
            $provider: '%app.hf_image.provider%'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones

    App\Service\CvAnalysisService:
        arguments:
            $geminiApiKey: '%gemini_api_key%'
            $httpClient: '@http_client'
